<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Menu</title>
</head>
<body>
    <h1>Menu de: <span id="client-name"></span></h1>
    
    <h3>Your Menus:</h3>
    <ul class="pdf-list"></ul>

    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-storage.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBFU2ZnJ1oh-7R5QkFEmoUOevQcTQ0mZ_w",
            authDomain: "qr-menu-383cd.firebaseapp.com",
            projectId: "qr-menu-383cd",
            storageBucket: "qr-menu-383cd.appspot.com",
            messagingSenderId: "98382457208",
            appId: "1:98382457208:web:d7d5acb86901141134008d"
        };

        firebase.initializeApp(firebaseConfig);
        
        const db = firebase.firestore();
        const storage = firebase.storage();

        const clientNameElement = document.getElementById('client-name');
        const pdfListElement = document.querySelector('.pdf-list');

        function getClientIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('clientId');
        }

        async function loadClientData(clientId) {
            const userDocRef = db.collection('clients').doc(clientId);
            const docSnapshot = await userDocRef.get();
            if (docSnapshot.exists) {
                const userData = docSnapshot.data();
                clientNameElement.textContent = userData.name;
                listUploadedPDFs(clientId);
            } else {
                clientNameElement.textContent = 'Client not found';
            }
        }

        // List uploaded PDFs for the user
        function listUploadedPDFs(userId) {
            const userStorageRef = storage.ref(`pdfs/${userId}`);
            userStorageRef.listAll().then((res) => {
                pdfListElement.innerHTML = '';
                res.items.forEach((itemRef) => {
                    itemRef.getDownloadURL().then((url) => {
                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = url;
                        link.textContent = itemRef.name;
                        listItem.appendChild(link);
                        pdfListElement.appendChild(listItem);
                    });
                });
            }).catch((error) => {
                console.log(error.message);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const clientId = getClientIdFromUrl();
            if (clientId) {
                loadClientData(clientId);
            } else {
                clientNameElement.textContent = 'Invalid client ID';
            }
        });
    </script>
</body>
</html>
