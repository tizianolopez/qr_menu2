<!-- menu.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Menu</title>
</head>
<body>
    <div id="pdf-list"></div>

    <!-- Firebase Scripts (Global CDN) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

    <script>
        // Your Firebase configuration
        const firebaseConfig = {
    apiKey: "AIzaSyBFU2ZnJ1oh-7R5QkFEmoUOevQcTQ0mZ_w",
    authDomain: "qr-menu-383cd.firebaseapp.com",
    projectId: "qr-menu-383cd",
    storageBucket: "qr-menu-383cd.appspot.com",
    messagingSenderId: "98382457208",
    appId: "1:98382457208:web:d7d5acb86901141134008d"
};


        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();

        // Function to list uploaded PDFs
        function listUploadedPDFs(userId) {
            const userStorageRef = firebase.storage().ref(`pdfs/${userId}`);
            userStorageRef.listAll().then((res) => {
                const pdfList = res.items.map((itemRef) => {
                    return { name: itemRef.name, ref: itemRef };
                });

                // Display PDF list
                const pdfListContainer = document.getElementById('pdf-list');
                pdfList.forEach((pdf) => {
                    const downloadButton = document.createElement('button');
                    downloadButton.textContent = `Download ${pdf.name}`;
                    downloadButton.addEventListener('click', () => {
                        downloadPdf(pdf.ref);
                    });
                    pdfListContainer.appendChild(downloadButton);
                });
            }).catch((error) => {
                console.error('Error listing PDFs:', error.message);
                pdfListContainer.innerHTML = '<p>No PDFs found.</p>';
            });
        }

        // Function to download a PDF
        function downloadPdf(pdfRef) {
            pdfRef.getDownloadURL().then((url) => {
                const xhr = new XMLHttpRequest();
                xhr.responseType = 'blob';
                xhr.onload = () => {
                    const blob = xhr.response;
                    const link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = pdfRef.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
                xhr.open('GET', url);
                xhr.send();
            }).catch((error) => {
                console.error('Error getting download URL:', error);
            });
        }

        // Assuming userId is obtained somehow (e.g., from authentication)
        const userId = 'YOUR_USER_ID'; // Replace with actual user ID

        // List PDFs for the current user
        listUploadedPDFs(userId);
    </script>
</body>
</html>
